using LambertProblem
using Test

@testset "LambertProblem.jl" begin
    @testset "Case 1" begin
        # Example Earth (2031/03/01 00:00:00 UTC) to Mars (2032/01/01 00:00:00 UTC)
        r1 = [-1.3905317294572383e8, 5.125349129587864e7, -2753.8250392638147]
        r2 = [2.0803122655020934e8, 1.8008145720647745e7, -4.721309430616008e6]
        tof = 2.643839999853146e7
        μ = 1.327124400419393e11

        # Solve Lambert's Problem
        v1, v2, num_sol = lambert_problem(r1, r2, tof, μ, 2)

        @test num_sol == 1
        @test v1[1, :] ≈ [-12.146901903784691, -30.249196666164899, 1.732823081867305]
        @test v2[1, :] ≈ [-5.062557143526494, 22.773747568054521, -1.043526507750940]

    end

    @testset "Case 2" begin
        # Example used in pykep Tutorial
        μ = 1.32712440018e+11
        r1 = [-25216645.728283768, 144924279.08132498, -38.276915766745136]
        r2 = [177909722.13822687, -105168473.55967535, -6575244.5882079229]
        tof = 55296000

        # Solve Lambert's Problem
        v1, v2, num_sol = lambert_problem(r1, r2, tof, μ, 2)

        @test num_sol == 3
        @test v1[1, :] ≈ [-35.499818966294406, 0.40742940300237478, 1.4595203390221081]
        @test v2[1, :] ≈ [3.0376984971968541, 27.064521805431243, -0.31914600319656404]
        @test v1[2, :] ≈ [-27.81451513546858, -15.91479886802767, 1.2599207890195353]
        @test v2[2, :] ≈ [16.828356734556462, 14.965476740707376, -0.80053299320499104]
        @test v1[3, :] ≈ [-26.997843155205635, -17.749606456280773, 1.2394297881268258]
        @test v2[3, :] ≈ [18.383111848123743, 13.641214500991762, -0.85508959337278111]

    end

    @testset "Case 3" begin
        # Example used in pykep Tutorial
        μ = 1.32712440018e+11
        r1 = [-2.4813057806272294e7, 1.449945066043632e8, -8.215121737733483e3]
        r2 = [-1.603115587336787e8, 1.846445550220809e7, -4.784110675475702e6]
        tof = 5.184e7

        # Solve Lambert's Problem
        v1, v2, num_sol = lambert_problem(r1, r2, tof, μ, 2)

        @test num_sol == 3
        @test v1[1, :] ≈ [-21.240058935496876, 27.686763544075136, -0.50382285400886622]
        @test v2[1, :] ≈ [27.049503001979407, -18.040826055804158, 0.73033361456994976]
        @test v1[2, :] ≈ [-22.652716083100953, 19.414672723686053, -0.58943525930414978]
        @test v2[2, :] ≈ [18.571456009600071, -19.622376845961542, 0.46414809512526563]
        @test v1[3, :] ≈ [-32.563106582947683, -7.2041105230019612, -1.0282043543619368]
        @test v2[3, :] ≈ [-8.9841267620155668, -29.532122399180287, -0.42558653591556856]

    end
end
